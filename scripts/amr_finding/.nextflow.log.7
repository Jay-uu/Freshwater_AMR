Mar-17 16:39:07.357 [main] DEBUG nextflow.cli.Launcher - $> nextflow run amr_finding_230317.nf -resume
Mar-17 16:39:07.695 [main] INFO  nextflow.cli.CmdRun - N E X T F L O W  ~  version 22.10.6
Mar-17 16:39:07.787 [main] DEBUG nextflow.plugin.PluginsFacade - Setting up plugin manager > mode=prod; embedded=false; plugins-dir=/home/jay/.nextflow/plugins; core-plugins: nf-amazon@1.11.3,nf-azure@0.14.2,nf-codecommit@0.1.2,nf-console@1.0.4,nf-ga4gh@1.0.4,nf-google@1.4.5,nf-tower@1.5.6,nf-wave@0.5.3
Mar-17 16:39:07.813 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Enabled plugins: []
Mar-17 16:39:07.814 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Disabled plugins: []
Mar-17 16:39:07.821 [main] INFO  org.pf4j.DefaultPluginManager - PF4J version 3.4.1 in 'deployment' mode
Mar-17 16:39:07.870 [main] INFO  org.pf4j.AbstractPluginManager - No plugins
Mar-17 16:39:08.127 [main] DEBUG nextflow.cli.CmdRun - Applied DSL=2 by global default
Mar-17 16:39:08.218 [main] INFO  nextflow.cli.CmdRun - Launching `amr_finding_230317.nf` [infallible_nobel] DSL2 - revision: 9433765c9d
Mar-17 16:39:08.219 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins default=[]
Mar-17 16:39:08.223 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins resolved requirement=[]
Mar-17 16:39:08.245 [main] DEBUG nextflow.secret.LocalSecretsProvider - Secrets store: /home/jay/.nextflow/secrets/store.json
Mar-17 16:39:08.269 [main] DEBUG nextflow.secret.SecretsLoader - Discovered secrets providers: [nextflow.secret.LocalSecretsProvider@732bb66d] - activable => nextflow.secret.LocalSecretsProvider@732bb66d
Mar-17 16:39:08.456 [main] DEBUG nextflow.Session - Session UUID: 5c9fe105-c65d-41d8-8210-ae38592a8572
Mar-17 16:39:08.456 [main] DEBUG nextflow.Session - Run name: infallible_nobel
Mar-17 16:39:08.456 [main] DEBUG nextflow.Session - Executor pool size: 24
Mar-17 16:39:08.490 [main] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'FileTransfer' minSize=10; maxSize=72; workQueue=LinkedBlockingQueue[10000]; allowCoreThreadTimeout=false
Mar-17 16:39:08.638 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 22.10.6 build 5843
  Created: 23-01-2023 23:20 UTC (24-01-2023 00:20 CEST)
  System: Linux 6.0.18-300.fc37.x86_64
  Runtime: Groovy 3.0.13 on OpenJDK 64-Bit Server VM 17.0.3-internal+0-adhoc..src
  Encoding: UTF-8 (UTF-8)
  Process: 1429186@kadath [77.235.248.125]
  CPUs: 24 - Mem: 125.7 GB (9.7 GB) - Swap: 157 GB (122.2 GB)
Mar-17 16:39:08.854 [main] DEBUG nextflow.Session - Work-dir: /home/jay/master_thesis/scripts/amr_finding/work [btrfs]
Mar-17 16:39:08.855 [main] DEBUG nextflow.Session - Script base path does not exist or is not a directory: /home/jay/master_thesis/scripts/amr_finding/bin
Mar-17 16:39:08.872 [main] DEBUG nextflow.executor.ExecutorFactory - Extension executors providers=[]
Mar-17 16:39:08.894 [main] DEBUG nextflow.Session - Observer factory: DefaultObserverFactory
Mar-17 16:39:08.969 [main] DEBUG nextflow.cache.CacheFactory - Using Nextflow cache factory: nextflow.cache.DefaultCacheFactory
Mar-17 16:39:09.012 [main] DEBUG nextflow.util.CustomThreadPool - Creating default thread pool > poolSize: 25; maxThreads: 1000
Mar-17 16:39:09.298 [main] DEBUG nextflow.Session - Session start
Mar-17 16:39:11.711 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
Mar-17 16:39:11.978 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 16:39:11.979 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 16:39:12.013 [main] DEBUG nextflow.executor.Executor - [warm up] executor > local
Mar-17 16:39:12.028 [main] DEBUG n.processor.LocalPollingMonitor - Creating local task monitor for executor 'local' > cpus=24; memory=125.7 GB; capacity=24; pollInterval=100ms; dumpInterval=5m
Mar-17 16:39:12.310 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 16:39:12.314 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 16:39:12.325 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 16:39:12.325 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 16:39:12.351 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 16:39:12.351 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 16:39:12.375 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 16:39:12.379 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 16:39:12.448 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 16:39:12.448 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 16:39:12.460 [main] DEBUG nextflow.Session - Workflow process names [dsl2]: run_abricate, parse_checkm_summary, run_gtdbtk, run_rgi, checkm_process, combine_all
Mar-17 16:39:12.461 [main] DEBUG nextflow.Session - Igniting dataflow network (7)
Mar-17 16:39:12.481 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > checkm_process
Mar-17 16:39:12.486 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > parse_checkm_summary
Mar-17 16:39:12.494 [PathVisitor-1] DEBUG nextflow.file.PathVisitor - files for syntax: glob; folder: /home/jay/data/test_bins/; pattern: *; options: [type:dir]
Mar-17 16:39:12.494 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > run_abricate
Mar-17 16:39:12.512 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > run_rgi
Mar-17 16:39:12.524 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > run_gtdbtk
Mar-17 16:39:12.530 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > combine_all
Mar-17 16:39:12.531 [main] DEBUG nextflow.script.ScriptRunner - > Awaiting termination 
Mar-17 16:39:12.531 [main] DEBUG nextflow.Session - Session await
Mar-17 16:39:12.750 [Actor Thread 22] ERROR nextflow.processor.TaskProcessor - Error executing process > 'run_rgi (2)'

Caused by:
  No such variable: line_countr -- Check script 'amr_finding_230317.nf' at line: 77

Source block:
  """
      echo '===== Start ${sample.baseName} ====='
      date
      sample_ID="${sample.baseName}"
      mkdir \${sample_ID}_bins
      for bin in $sample/*.tar.gz
      do
          tar -xf \$bin -C \${sample_ID}_bins --wildcards '*.faa.gz' --strip-components=3
      done
      
      gunzip \${sample_ID}_bins/*.faa.gz
      sed -i 's/[*]//g' \${sample_ID}_bins/*.faa
      mkdir \${sample_ID}_res
      for file in \${sample_ID}_bins/*
      do
          line_countr=`zcat \$file | wc -l`
          if [ $line_countr == 0 ]
              then
                  echo "Empty bin, skipped: \$file"
                  continue
          fi
          echo "running bin: \$file"
          BIN_ID=`basename \$file .faa`
          rgi main --input_sequence \$file --output_file \${sample_ID}_res/\${BIN_ID} -t protein -n 23 -a DIAMOND --low_quality --clean
      done
      date
      echo '===== Done ${sample.baseName} ====='
      """

Tip: you can replicate the issue by changing to the process work dir and entering the command `bash .command.run`
Mar-17 16:39:12.811 [Actor Thread 22] DEBUG nextflow.Session - Session aborted -- Cause: Process `run_rgi (2)` script contains error(s)
Mar-17 16:39:12.868 [Actor Thread 22] DEBUG nextflow.Session - The following nodes are still active:
[process] checkm_process
  status=ACTIVE
  port 0: (queue) closed; channel: sample
  port 1: (cntrl) -     ; channel: $

[process] parse_checkm_summary
  status=ACTIVE
  port 0: (queue) OPEN  ; channel: -
  port 1: (cntrl) -     ; channel: $

[process] run_abricate
  status=ACTIVE
  port 0: (queue) closed; channel: sample
  port 1: (cntrl) -     ; channel: $

[process] run_rgi
  status=ACTIVE
  port 0: (queue) closed; channel: sample
  port 1: (cntrl) -     ; channel: $

[process] run_gtdbtk
  status=ACTIVE
  port 0: (queue) closed; channel: sample
  port 1: (cntrl) -     ; channel: $

[process] combine_all
  status=ACTIVE
  port 0: (queue) OPEN  ; channel: -
  port 1: (cntrl) -     ; channel: $

Mar-17 16:39:12.878 [main] DEBUG nextflow.Session - Session await > all processes finished
Mar-17 16:39:12.878 [main] DEBUG nextflow.Session - Session await > all barriers passed
Mar-17 16:39:12.887 [main] DEBUG nextflow.trace.WorkflowStatsObserver - Workflow completed > WorkflowStats[succeededCount=0; failedCount=0; ignoredCount=0; cachedCount=0; pendingCount=3; submittedCount=0; runningCount=0; retriesCount=0; abortedCount=0; succeedDuration=0ms; failedDuration=0ms; cachedDuration=0ms;loadCpus=0; loadMemory=0; peakRunning=0; peakCpus=0; peakMemory=0; ]
Mar-17 16:39:12.916 [Actor Thread 18] INFO  nextflow.processor.TaskProcessor - [dd/7e5e9e] Cached process > run_abricate (2)
Mar-17 16:39:12.917 [Actor Thread 19] INFO  nextflow.processor.TaskProcessor - [5f/caa092] Cached process > run_gtdbtk (2)
Mar-17 16:39:12.916 [Actor Thread 17] INFO  nextflow.processor.TaskProcessor - [0a/32165f] Cached process > checkm_process (2)
Mar-17 16:39:12.963 [Actor Thread 19] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'PublishDir' minSize=10; maxSize=72; workQueue=LinkedBlockingQueue[10000]; allowCoreThreadTimeout=false
Mar-17 16:39:13.052 [main] DEBUG nextflow.cache.CacheDB - Closing CacheDB done
Mar-17 16:39:13.122 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
