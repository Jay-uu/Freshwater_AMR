Mar-17 13:14:45.840 [main] DEBUG nextflow.cli.Launcher - $> nextflow run amr_finding_230317.nf -resume
Mar-17 13:14:46.151 [main] INFO  nextflow.cli.CmdRun - N E X T F L O W  ~  version 22.10.6
Mar-17 13:14:46.258 [main] DEBUG nextflow.plugin.PluginsFacade - Setting up plugin manager > mode=prod; embedded=false; plugins-dir=/home/jay/.nextflow/plugins; core-plugins: nf-amazon@1.11.3,nf-azure@0.14.2,nf-codecommit@0.1.2,nf-console@1.0.4,nf-ga4gh@1.0.4,nf-google@1.4.5,nf-tower@1.5.6,nf-wave@0.5.3
Mar-17 13:14:46.352 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Enabled plugins: []
Mar-17 13:14:46.354 [main] INFO  org.pf4j.DefaultPluginStatusProvider - Disabled plugins: []
Mar-17 13:14:46.367 [main] INFO  org.pf4j.DefaultPluginManager - PF4J version 3.4.1 in 'deployment' mode
Mar-17 13:14:46.442 [main] INFO  org.pf4j.AbstractPluginManager - No plugins
Mar-17 13:14:46.659 [main] DEBUG nextflow.cli.CmdRun - Applied DSL=2 by global default
Mar-17 13:14:46.729 [main] INFO  nextflow.cli.CmdRun - Launching `amr_finding_230317.nf` [reverent_rubens] DSL2 - revision: 80d82f615f
Mar-17 13:14:46.730 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins default=[]
Mar-17 13:14:46.734 [main] DEBUG nextflow.plugin.PluginsFacade - Plugins resolved requirement=[]
Mar-17 13:14:46.751 [main] DEBUG nextflow.secret.LocalSecretsProvider - Secrets store: /home/jay/.nextflow/secrets/store.json
Mar-17 13:14:46.772 [main] DEBUG nextflow.secret.SecretsLoader - Discovered secrets providers: [nextflow.secret.LocalSecretsProvider@732bb66d] - activable => nextflow.secret.LocalSecretsProvider@732bb66d
Mar-17 13:14:46.868 [main] DEBUG nextflow.Session - Session UUID: 5c9fe105-c65d-41d8-8210-ae38592a8572
Mar-17 13:14:46.868 [main] DEBUG nextflow.Session - Run name: reverent_rubens
Mar-17 13:14:46.868 [main] DEBUG nextflow.Session - Executor pool size: 24
Mar-17 13:14:46.911 [main] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'FileTransfer' minSize=10; maxSize=72; workQueue=LinkedBlockingQueue[10000]; allowCoreThreadTimeout=false
Mar-17 13:14:47.012 [main] DEBUG nextflow.cli.CmdRun - 
  Version: 22.10.6 build 5843
  Created: 23-01-2023 23:20 UTC (24-01-2023 00:20 CEST)
  System: Linux 6.0.18-300.fc37.x86_64
  Runtime: Groovy 3.0.13 on OpenJDK 64-Bit Server VM 17.0.3-internal+0-adhoc..src
  Encoding: UTF-8 (UTF-8)
  Process: 3473405@kadath [77.235.248.125]
  CPUs: 24 - Mem: 125.7 GB (1.3 GB) - Swap: 157 GB (126.4 GB)
Mar-17 13:14:47.140 [main] DEBUG nextflow.Session - Work-dir: /home/jay/master_thesis/scripts/amr_finding/work [btrfs]
Mar-17 13:14:47.141 [main] DEBUG nextflow.Session - Script base path does not exist or is not a directory: /home/jay/master_thesis/scripts/amr_finding/bin
Mar-17 13:14:47.155 [main] DEBUG nextflow.executor.ExecutorFactory - Extension executors providers=[]
Mar-17 13:14:47.183 [main] DEBUG nextflow.Session - Observer factory: DefaultObserverFactory
Mar-17 13:14:47.265 [main] DEBUG nextflow.cache.CacheFactory - Using Nextflow cache factory: nextflow.cache.DefaultCacheFactory
Mar-17 13:14:47.343 [main] DEBUG nextflow.util.CustomThreadPool - Creating default thread pool > poolSize: 25; maxThreads: 1000
Mar-17 13:14:47.619 [main] DEBUG nextflow.Session - Session start
Mar-17 13:14:50.876 [main] DEBUG nextflow.script.ScriptRunner - > Launching execution
Mar-17 13:14:51.174 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 13:14:51.175 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 13:14:51.188 [main] DEBUG nextflow.executor.Executor - [warm up] executor > local
Mar-17 13:14:51.198 [main] DEBUG n.processor.LocalPollingMonitor - Creating local task monitor for executor 'local' > cpus=24; memory=125.7 GB; capacity=24; pollInterval=100ms; dumpInterval=5m
Mar-17 13:14:51.394 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 13:14:51.395 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 13:14:51.409 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 13:14:51.409 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 13:14:51.420 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 13:14:51.420 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 13:14:51.428 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 13:14:51.429 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 13:14:51.476 [main] DEBUG nextflow.executor.ExecutorFactory - << taskConfig executor: null
Mar-17 13:14:51.477 [main] DEBUG nextflow.executor.ExecutorFactory - >> processorType: 'local'
Mar-17 13:14:51.479 [main] DEBUG nextflow.Session - Workflow process names [dsl2]: run_abricate, parse_checkm_summary, run_gtdbtk, run_rgi, checkm_process, combine_all
Mar-17 13:14:51.480 [main] DEBUG nextflow.Session - Igniting dataflow network (7)
Mar-17 13:14:51.498 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > checkm_process
Mar-17 13:14:51.501 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > parse_checkm_summary
Mar-17 13:14:51.499 [PathVisitor-1] DEBUG nextflow.file.PathVisitor - files for syntax: glob; folder: /home/jay/data/test_bins/; pattern: *; options: [type:dir]
Mar-17 13:14:51.505 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > run_abricate
Mar-17 13:14:51.509 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > run_rgi
Mar-17 13:14:51.513 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > run_gtdbtk
Mar-17 13:14:51.521 [main] DEBUG nextflow.processor.TaskProcessor - Starting process > combine_all
Mar-17 13:14:51.525 [main] DEBUG nextflow.script.ScriptRunner - > Awaiting termination 
Mar-17 13:14:51.525 [main] DEBUG nextflow.Session - Session await
Mar-17 13:14:52.022 [Actor Thread 23] INFO  nextflow.processor.TaskProcessor - [5b/10fb9b] Cached process > run_rgi (1)
Mar-17 13:14:52.025 [Actor Thread 13] INFO  nextflow.processor.TaskProcessor - [0a/32165f] Cached process > checkm_process (2)
Mar-17 13:14:52.026 [Actor Thread 17] INFO  nextflow.processor.TaskProcessor - [04/3257c8] Cached process > run_rgi (2)
Mar-17 13:14:52.026 [Actor Thread 21] INFO  nextflow.processor.TaskProcessor - [b0/35674a] Cached process > checkm_process (1)
Mar-17 13:14:52.026 [Actor Thread 22] INFO  nextflow.processor.TaskProcessor - [25/8315ed] Cached process > run_abricate (1)
Mar-17 13:14:52.026 [Actor Thread 11] INFO  nextflow.processor.TaskProcessor - [dd/7e5e9e] Cached process > run_abricate (2)
Mar-17 13:14:52.027 [Actor Thread 14] INFO  nextflow.processor.TaskProcessor - [5f/caa092] Cached process > run_gtdbtk (2)
Mar-17 13:14:52.067 [Actor Thread 9] INFO  nextflow.processor.TaskProcessor - [09/06e059] Cached process > parse_checkm_summary (1)
Mar-17 13:14:52.130 [Actor Thread 8] INFO  nextflow.processor.TaskProcessor - [7a/48519f] Cached process > parse_checkm_summary (2)
Mar-17 13:14:52.152 [Actor Thread 8] DEBUG nextflow.util.ThreadPoolBuilder - Creating thread pool 'PublishDir' minSize=10; maxSize=72; workQueue=LinkedBlockingQueue[10000]; allowCoreThreadTimeout=false
Mar-17 13:14:52.293 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Mar-17 13:14:52.296 [Task submitter] INFO  nextflow.Session - [d8/de90ba] Submitted process > run_gtdbtk (1)
Mar-17 13:14:52.330 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Mar-17 13:14:52.341 [Task submitter] INFO  nextflow.Session - [a3/033936] Submitted process > combine_all (1)
Mar-17 13:14:55.237 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 11; name: combine_all (1); status: COMPLETED; exit: 0; error: -; workDir: /home/jay/master_thesis/scripts/amr_finding/work/a3/0339365def7ebe149b1e65f42aa3f0]
Mar-17 13:19:51.400 [Task monitor] DEBUG n.processor.TaskPollingMonitor - !! executor local > tasks to be completed: 1 -- submitted tasks are shown below
~> TaskHandler[id: 3; name: run_gtdbtk (1); status: RUNNING; exit: -; error: -; workDir: /home/jay/master_thesis/scripts/amr_finding/work/d8/de90ba8f2d4da2de750c29fce4d827]
Mar-17 13:24:51.454 [Task monitor] DEBUG n.processor.TaskPollingMonitor - !! executor local > tasks to be completed: 1 -- submitted tasks are shown below
~> TaskHandler[id: 3; name: run_gtdbtk (1); status: RUNNING; exit: -; error: -; workDir: /home/jay/master_thesis/scripts/amr_finding/work/d8/de90ba8f2d4da2de750c29fce4d827]
Mar-17 13:28:56.320 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 3; name: run_gtdbtk (1); status: COMPLETED; exit: 0; error: -; workDir: /home/jay/master_thesis/scripts/amr_finding/work/d8/de90ba8f2d4da2de750c29fce4d827]
Mar-17 13:28:56.387 [Task submitter] DEBUG n.executor.local.LocalTaskHandler - Launch cmd line: /bin/bash -ue .command.run
Mar-17 13:28:56.390 [Task submitter] INFO  nextflow.Session - [54/6c31bc] Submitted process > combine_all (2)
Mar-17 13:28:57.280 [Task monitor] DEBUG n.processor.TaskPollingMonitor - Task completed > TaskHandler[id: 12; name: combine_all (2); status: COMPLETED; exit: 1; error: -; workDir: /home/jay/master_thesis/scripts/amr_finding/work/54/6c31bccad67349042a6224b0d2311c]
Mar-17 13:28:57.314 [Task monitor] ERROR nextflow.processor.TaskProcessor - Error executing process > 'combine_all (2)'

Caused by:
  Process `combine_all (2)` terminated with an error exit status (1)

Command executed:

  python3 /home/jay/master_thesis/scripts/parse_amr_res_nf.py -rgi ErkenSummer_res -abr ErkenSummer_abricate.tab -chm ErkenSummer_summary.json -tax ErkenSummer_result/gtdbtk.bac120.summary.tsv -o ErkenSummer.json

Command exit status:
  1

Command output:
  =====Reading and formatting index======
  ====== Reading and formatting abricate results======
  Adding ARO terms
  ======Reading and formatting RGI results====
  ErkenSummer_megahit_metabat_bin-0698: Done
  ErkenSummer_megahit_metabat_bin-0698: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  =====Creating aro_info file======
  =====Reading checkm data======
  =====Reading GTDB-Tk data======
  =====Combining Abricate and RGI Strict results======
  Creating nested dictionary
  Adding bin: ErkenSummer_ErkenSummer_megahit_metabat_bin-0698

Command error:
  /home/jay/master_thesis/scripts/parse_amr_res_nf.py:104: FutureWarning: The default value of regex will change from True to False in a future version.
    taxonomy['user_genome'] = taxonomy['user_genome'].str.replace(r'.fna','')
  /home/jay/master_thesis/scripts/parse_amr_res_nf.py:115: FutureWarning: The default value of regex will change from True to False in a future version.
    comb_tofile['#FILE'] = comb_tofile['#FILE'].str.replace(r'.ffn.gz', '')
  =====Reading and formatting index======
  ====== Reading and formatting abricate results======
  Adding ARO terms
  ======Reading and formatting RGI results====
  ErkenSummer_megahit_metabat_bin-0698: Done
  ErkenSummer_megahit_metabat_bin-0698: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  ErkenSummer_megahit_metabat_bin-unbinned: Done
  =====Creating aro_info file======
  =====Reading checkm data======
  =====Reading GTDB-Tk data======
  =====Combining Abricate and RGI Strict results======
  Creating nested dictionary
  Adding bin: ErkenSummer_ErkenSummer_megahit_metabat_bin-0698
  Traceback (most recent call last):
    File "/home/jay/master_thesis/scripts/parse_amr_res_nf.py", line 127, in <module>
      'Completeness': checkm[bins[b]]['Completeness'], 'Contamination': checkm[bins[b]]['Contamination'],
  KeyError: 'ErkenSummer_ErkenSummer_megahit_metabat_bin-0698'

Work dir:
  /home/jay/master_thesis/scripts/amr_finding/work/54/6c31bccad67349042a6224b0d2311c

Tip: you can replicate the issue by changing to the process work dir and entering the command `bash .command.run`
Mar-17 13:28:57.327 [Task monitor] DEBUG nextflow.Session - Session aborted -- Cause: Process `combine_all (2)` terminated with an error exit status (1)
Mar-17 13:28:57.329 [main] DEBUG nextflow.Session - Session await > all processes finished
Mar-17 13:28:57.360 [main] DEBUG nextflow.Session - Session await > all barriers passed
Mar-17 13:28:57.389 [main] DEBUG nextflow.trace.WorkflowStatsObserver - Workflow completed > WorkflowStats[succeededCount=2; failedCount=1; ignoredCount=0; cachedCount=9; pendingCount=0; submittedCount=0; runningCount=0; retriesCount=0; abortedCount=0; succeedDuration=14m 7s; failedDuration=845ms; cachedDuration=26m 43s;loadCpus=0; loadMemory=0; peakRunning=2; peakCpus=2; peakMemory=0; ]
Mar-17 13:28:57.580 [main] DEBUG nextflow.cache.CacheDB - Closing CacheDB done
Mar-17 13:28:57.620 [main] DEBUG nextflow.script.ScriptRunner - > Execution complete -- Goodbye
